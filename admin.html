<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard - BOLA ID UPDATE</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: auto; padding: 20px; }
    h1 { color: #7033b8; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px;}
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left;}
    th { background-color: #033b86; color: white;}
    button { background-color: #7033b8; border: none; padding: 6px 12px; cursor: pointer; border-radius: 4px; color: white; }
    button:hover { background-color: #5a0202; }
    input, textarea { width: 100%; padding: 8px; margin-bottom: 8px; box-sizing: border-box; }
    #loginSection { max-width: 400px; margin: 0 auto 20px; }
    #btnLogout { margin-top: 15px; background: #f44336; color: white; border: none; padding: 8px 12px; cursor: pointer; border-radius: 4px; display:none; }
  </style>
  <!-- Firebase SDK (modular) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
</head>
<body>

  <!-- Bagian Login -->
  <div id="loginSection">
    <h2>Login Admin</h2>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button id="btnLogin">Login</button>
    <p id="loginError" style="color:red;"></p>
  </div>

  <h1 id="dashboardTitle" style="display:none;">Admin Dashboard - Kelola Berita</h1>
  <form id="formTambahBerita" style="display:none;">
    <h3 id="formTitle">Tambah Berita Baru</h3>
    <input type="text" id="judul" placeholder="Judul" required />
    <input type="date" id="tanggal" required />
    <input type="text" id="gambar" placeholder="URL Gambar (opsional)" />
    <textarea id="isi" placeholder="Isi Berita" required rows="4"></textarea>
    <button type="submit" id="btnSubmit">Tambah Berita</button>
    <button type="button" id="btnCancelEdit" style="display:none; margin-left: 10px; background: #999;">Batal Edit</button>
  </form>

  <h3 id="daftarBeritaTitle" style="display:none;">Daftar Berita</h3>
  <table id="tabelBerita" style="display:none;">
    <thead>
      <tr>
        <th>Judul</th>
        <th>Tanggal</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button id="btnLogout">Logout</button>

  <script>
    // Firebase config dan init
    const firebaseConfig = {
      apiKey: "AIzaSyCm3bqo01GU4EnYDnUjy7rhzkY3teHMNpY",
      authDomain: "sarjanabola-980e4.firebaseapp.com",
      projectId: "sarjanabola-980e4",
      storageBucket: "sarjanabola-980e4.appspot.com",
      messagingSenderId: "834425792870",
      appId: "1:834425792870:web:e865ba0a526d20f06e40a7",
      measurementId: "G-Q36V68S5NM"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM elements
    const loginSection = document.getElementById('loginSection');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const btnLogin = document.getElementById('btnLogin');
    const loginError = document.getElementById('loginError');

    const dashboardTitle = document.getElementById('dashboardTitle');
    const form = document.getElementById('formTambahBerita');
    const formTitle = document.getElementById('formTitle');
    const btnSubmit = document.getElementById('btnSubmit');
    const btnCancelEdit = document.getElementById('btnCancelEdit');

    const judulInput = document.getElementById('judul');
    const tanggalInput = document.getElementById('tanggal');
    const gambarInput = document.getElementById('gambar');
    const isiInput = document.getElementById('isi');

    const daftarBeritaTitle = document.getElementById('daftarBeritaTitle');
    const tabelBerita = document.getElementById('tabelBerita');
    const tabelBody = tabelBerita.querySelector('tbody');
    const btnLogout = document.getElementById('btnLogout');

    let editId = null; // menyimpan ID berita yg diedit

    // Render daftar berita dengan tombol edit dan hapus
    function renderBerita() {
      tabelBody.innerHTML = '';
      db.collection("berita").orderBy("tanggal", "desc").get().then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          const berita = doc.data();
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${berita.judul}</td>
            <td>${berita.tanggal}</td>
            <td>
              <button onclick="editBerita('${doc.id}')">Edit</button>
              <button onclick="hapusBerita('${doc.id}')">Hapus</button>
            </td>
          `;
          tabelBody.appendChild(row);
        });
      });
    }

    // Fungsi hapus berita
    window.hapusBerita = function(id) {
      if(confirm('Yakin ingin menghapus berita ini?')) {
        db.collection("berita").doc(id).delete().then(() => {
          alert('Berita dihapus.');
          renderBerita();
        }).catch(err => alert('Gagal menghapus berita: ' + err));
      }
    }

    // Fungsi edit berita: isi form dengan data berita yg di klik
    window.editBerita = function(id) {
      db.collection("berita").doc(id).get().then(doc => {
        if (!doc.exists) {
          alert('Berita tidak ditemukan!');
          return;
        }
        const data = doc.data();
        editId = id;
        formTitle.textContent = 'Edit Berita';
        btnSubmit.textContent = 'Update Berita';
        btnCancelEdit.style.display = 'inline-block';

        judulInput.value = data.judul;
        tanggalInput.value = data.tanggal;
        gambarInput.value = data.gambar || '';
        isiInput.value = data.isi;

        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }

    // Batal edit
    btnCancelEdit.addEventListener('click', () => {
      editId = null;
      formTitle.textContent = 'Tambah Berita Baru';
      btnSubmit.textContent = 'Tambah Berita';
      btnCancelEdit.style.display = 'none';
      form.reset();
    });

    // Submit form tambah/edit berita
    form.addEventListener('submit', e => {
      e.preventDefault();
      const judul = judulInput.value.trim();
      const tanggal = tanggalInput.value;
      const gambar = gambarInput.value.trim();
      const isi = isiInput.value.trim();

      if (!judul || !tanggal || !isi) {
        alert('Judul, tanggal dan isi wajib diisi!');
        return;
      }

      if (editId) {
        // update berita
        db.collection("berita").doc(editId).update({ judul, tanggal, gambar, isi })
          .then(() => {
            alert('Berita berhasil diperbarui!');
            form.reset();
            editId = null;
            formTitle.textContent = 'Tambah Berita Baru';
            btnSubmit.textContent = 'Tambah Berita';
            btnCancelEdit.style.display = 'none';
            renderBerita();
          })
          .catch(err => alert('Gagal update berita: ' + err));
      } else {
        // tambah berita baru
        db.collection("berita").add({ judul, tanggal, gambar, isi })
